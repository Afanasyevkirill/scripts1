(self.webpackChunkof_vue=self.webpackChunkof_vue||[]).push([[26564],{140711:function(e,i,t){"use strict";t.d(i,{A:function(){return d}});var s=function e(){var i=this,t=i._self._c;return t("div",{staticClass:"b-not-allowed-drm-description g-sides-gaps"},[t("div",[t("svg",{directives:[{name:"svg-sprite",rawName:"v-svg-sprite"}],staticClass:"icon-alert"})]),i._v(" "+i._s(i.$t("message.unsupported_post_media_drm_alert"))+" ")])},o=[],n,r={name:"NotAllowedDrmPlaceholder"},a,l,d=(0,t(281656).A)(r,s,o,!1,null,null,null).exports},242e3:function(e,i,t){var s=t(663945),o=t(662429),n=t(315389),r=t(956449);function a(e,i){return function(t,a){var l=r(t)?s:o,d=i?i():{};return l(t,e,n(a,2),d)}}e.exports=a},331607:function(e,i,t){"use strict";t.d(i,{A:function(){return k}});var s=function e(){var i=this,t=i._self._c;return t("div",{directives:[{name:"waypoint",rawName:"v-waypoint",value:{active:!0,callback:i.onWaypoint,options:i.intersectionOptions},expression:"{\n    active: true,\n    callback: onWaypoint,\n    options: intersectionOptions\n  }"}],key:i.keyUnique,ref:"videoWrapper",staticClass:"video-wrapper",class:{"m-hide-video-controls":i.didTheVideoPlayDuringExitFullscreen},style:i.postVideoStyles},[i.showPlaceholder&&i.previewLoaded?t("div",{staticClass:"b-post__media-bg",style:{backgroundImage:`url(${i.media.thumb||i.videoCommonMixin_preview})`}}):i._e(),i.showPlaceholder?t("post-video-placeholder",{attrs:{media:i.media,"preview-loaded":i.previewLoaded,"show-placeholder-running":i.showPlaceholderRunning,"show-video-loader":i.showVideoLoader},on:{onClick:i.onVideoPlaceholderClick,placeholderImageLoaded:i.placeholderImageLoaded}}):i._e(),i.showPlayer?t("post-video-player",{attrs:{id:i.id,"stream-id":i.streamId,type:i.type,media:i.media,"show-placeholder":i.showPlaceholder,"show-placeholder-running":i.showPlaceholderRunning,"need-reset-video-player":i.needResetOnWayPoint},on:{setNeedToResetOnWaypoint:i.setNeedToResetOnWaypoint,simpleClick:i.setSimpleClick,doubleClick:i.setDoubleClick,setPlaceholder:i.setPlaceholder,clearWrapperStyles:i.clearWrapperStyles,changeVideoState:i.setChangeVideoState,setDidTheVideoPlayDuringExitFullscreen:i.setDidTheVideoPlayDuringExitFullscreen,drmError:i.onDrmError,videoError:i.onVideoError,onShowVideoLoader:i.onShowVideoLoader}}):i._e()],1)},o=[],n=t(962953),r=t(826489),a=t(462137),l=t(110908),d=t(447836),u=t(463670),h=function e(){var i=this,t=i._self._c;return t("div",{directives:[{name:"double-click",rawName:"v-double-click",value:i.onVideoPlaceholderClick,expression:"onVideoPlaceholderClick"}],staticClass:"video-js video-js-placeholder-wrapper"},[t("div",{staticClass:"vjs-tech placeholder-preview post_img_big d-flex align-items-center",class:{"no-placeholder-preview":!i.previewLoaded,"m-not-allowed":i.isNotAllowedDrmMedia,"m-custom-cover":i.hasSelectedCustomThumb}},[i.showVideoPreview?t("div",{staticClass:"b-placeholder-preview d-flex justify-content-center align-items-center w-100"},[t("img",{staticClass:"m-img-not-fluid m-object-contain w-100",attrs:{src:i.videoCommonMixin_preview,width:i.videoCommonMixin_mediaWidth,height:i.videoCommonMixin_mediaHeight,alt:"",loading:"lazy"},on:{load:i.onPlaceholderImageLoaded,error:i.onPlaceholderImageError}})]):i._e(),i.isNotAllowedDrmMedia?t("not-allowed-drm-placeholder"):i._e()],1),i.showInitialBigPlayVideoBtn?t("button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:i.$t("message.play_video"),expression:"$t('message.play_video')"}],staticClass:"vjs-big-play-button",attrs:{type:"button","aria-disabled":"false"}},[t("span",{staticClass:"vjs-icon-placeholder",attrs:{"aria-hidden":"true"}}),t("span",{staticClass:"vjs-control-text",attrs:{"aria-live":"polite"}},[i._v(" "+i._s(i.$t("message.play_video"))+" ")])]):i._e()])},c=[],m=t(218111),p=t(13579),v=t(140711),g=t(580503),y,f={name:"PostVideoPlaceholder",components:{NotAllowedDrmPlaceholder:v.A},directives:{doubleClick:d.Ay},mixins:[g.A,a.A],props:{showPlaceholderRunning:{type:Boolean,default:!1},previewLoaded:{type:Boolean,default:!0},showVideoLoader:{type:Boolean,default:!1}},data(){return{isPreviewLoadError:!1}},computed:{...(0,l.WsE)(["drm"]),isAllowedToSeeDrmMedia(){var e;return!(null===(e=this.drmMixin_settings)||void 0===e||!e.drmType)},isNotAllowedDrmMedia(){return this.drmMixin_isMediaDrm(this.media)&&!this.drmMixin_isLoadingSettings&&!this.isAllowedToSeeDrmMedia},showInitialBigPlayVideoBtn(){return!this.isNotAllowedDrmMedia&&!this.showVideoLoader&&!this.showPlaceholderRunning},hasSelectedCustomThumb(){var e;return(null===(e=this.media.files)||void 0===e||null===(e=e.preview)||void 0===e||null===(e=e.options)||void 0===e?void 0:e.some((e=>e.custom&&e.selected)))||this.media.hasCustomPreview},showVideoPreview(){return this.videoCommonMixin_preview&&!this.isPreviewLoadError}},mounted(){this.videoCommonMixin_preview||this.onPlaceholderImageLoaded()},methods:{onPlaceholderImageLoaded(){this.$emit("placeholderImageLoaded"),this.isPreviewLoadError=!1},onPlaceholderImageError(){this.onPlaceholderImageLoaded(),this.isPreviewLoadError=!0},onVideoPlaceholderClick(e,i){this.isNotAllowedDrmMedia||this.showVideoLoader||this.$emit("onClick",{event:e,mode:i})}}},w=t(281656),b,P=(0,w.A)(f,h,c,!1,null,"547018ea",null).exports,C=t(350219),M,x={name:"PostVideo",components:{PostVideoPlaceholder:P,PostVideoPlayer:()=>Promise.all([t.e(98151),t.e(74514),t.e(52977),t.e(67700),t.e(8695),t.e(77152),t.e(94784),t.e(60182),t.e(15752),t.e(58925),t.e(82357),t.e(30711),t.e(26237),t.e(77945)]).then(t.bind(t,294086))},mixins:[a.A],props:{id:{type:Number,default:0},streamId:{type:Number,default:0},type:{type:String,default:u.Tj.POST},isSlideItem:{type:Boolean,default:!1}},data(){return{keyUnique:+new Date,intersectionOptions:{threshold:[.5,.75]},didTheVideoPlayDuringExitFullscreen:null,showPlaceholder:!0,showPlaceholderRunning:!1,showPlayer:!1,previewLoaded:!0,needResetOnWayPoint:!1,isPlaying:!1,showVideoLoader:!1,restoreVideoWrapperCssText:null}},computed:{...(0,l.bP$)(["currentPlayVideo"]),postVideoStyles(){var e;if(!this.videoCommonMixin_mediaHeight||!this.videoCommonMixin_mediaWidth)return{};const i={},{width:t=0,height:s=0}=(null===(e=this.media.files)||void 0===e?void 0:e.preview)||{},o=this.videoCommonMixin_mediaHeight/this.videoCommonMixin_mediaWidth*100;return!this.isSlideItem||this.videoCommonMixin_mediaWidth<this.videoCommonMixin_mediaHeight&&t>s?(i.paddingTop=`${o}%`,i.height="auto",i.maxHeight=`${this.videoCommonMixin_mediaHeight}px`):this.videoCommonMixin_mediaWidth>this.videoCommonMixin_mediaHeight&&t<s&&(i.paddingTop=`${o}%`),i}},mounted(){document.addEventListener("visibilitychange",this.visibilityChangeHandler)},beforeDestroy(){document.removeEventListener("visibilitychange",this.visibilityChangeHandler)},methods:{setSimpleClick(e){this.$emit("simpleClick",e)},setDoubleClick(e){this.$emit("doubleClick",e)},setChangeVideoState(e){this.$emit("changeVideoState",{mediaId:this.media.id,isPlaying:e}),this.isPlaying=e},setPlaceholder(e){this.showPlaceholder=e},setNeedToResetOnWaypoint(e){this.needResetOnWayPoint=e},clearWrapperStyles(){this.$refs.videoWrapper&&"function"==typeof this.restoreVideoWrapperCssText&&this.restoreVideoWrapperCssText()},setDidTheVideoPlayDuringExitFullscreen(e){this.didTheVideoPlayDuringExitFullscreen=e},visibilityChangeHandler(){document.hidden&&r.isMobile&&r.isFirefox&&this.currentPlayVideo&&this.$root.$emit("pausePlayerVideo")},onVideoPlaceholderClick({event:e,mode:i}){i===d.Nl.CLICK&&(this.showPlaceholder&&!this.showPlayer&&this.mountPlayer(),this.$emit("simpleClick",e)),i===d.Nl.DOUBLE_CLICK&&this.$emit("doubleClick",e)},placeholderImageLoaded(){this.$emit("load"),this.$nextTick((()=>{this.$refs.videoWrapper&&"function"==typeof this.restoreVideoWrapperCssText&&this.restoreVideoWrapperCssText()}))},mountPlayer(){this.$root.$emit("pausePlayerVideo"),this.$refs.videoWrapper&&(this.restoreVideoWrapperCssText=(0,C.A)(this.$refs.videoWrapper,{height:`${this.$refs.videoWrapper.offsetHeight}px`})),this.showPlayer=!0,this.showPlaceholderRunning=!0},onWaypoint({going:e}){e===this.$waypointMap.GOING_OUT&&this.isPlaying&&(this.needResetOnWayPoint=!0)},onDrmError(){this.$emit("drmError")},onVideoError(e){this.$emit("videoError",e)},onShowVideoLoader(e){this.showVideoLoader=e}}},_,k=(0,w.A)(x,s,o,!1,null,"61f1e920",null).exports},375168:function(e,i,t){"use strict";t.d(i,{A:function(){return v}});var s=function e(){var i,t=this,s=t._self._c;return s("figure",{ref:"gifWrapper",staticClass:"post_img_big",class:{"m-fullscreen":t.isFullscreen},on:{fullscreenchange:t.onFullscreenChange,webkitfullscreenchange:t.onFullscreenChange,mozfullscreenchange:t.onFullscreenChange,MSFullscreenChange:t.onFullscreenChange}},[s("div",{directives:[{name:"observe-visibility",rawName:"v-observe-visibility",value:t.visibilityChanged,expression:"visibilityChanged"},{name:"double-click",rawName:"v-double-click",value:t.onDoubleClick,expression:"onDoubleClick"}],staticClass:"post_gif"},[s("div",{staticClass:"b-post__media-bg",style:{backgroundImage:`url(${(null===(i=t.media.files)||void 0===i||null===(i=i.thumb)||void 0===i?void 0:i.url)||t.videoCommonMixin_preview})`}}),s("span",{directives:[{name:"show",rawName:"v-show",value:!t.isPlaying,expression:"!isPlaying"}],staticClass:"post_gif_play m-no-pointer g-btn-play m-lg-size"},[s("svg",{directives:[{name:"svg-sprite",rawName:"v-svg-sprite:icon-play",arg:"icon-play"}]})]),t.isVideo?s("video",{ref:"videoElement",staticClass:"post_gif_media",attrs:{poster:t.videoCommonMixin_preview,loop:"",muted:"",playsinline:""},domProps:{muted:!0},on:{pause:t.onPauseVideo,play:t.onPlayVideo,webkitbeginfullscreen:t.onFullscreenChange,webkitendfullscreen:t.onFullscreenChange,"~canplaythrough":function(e){return t.onMediaLoaded.apply(null,arguments)},error:function(e){return t.$emit("mediaError",e)}}},[s("source",{attrs:{type:"video/mp4",src:t.mediaFull},on:{error:function(e){return t.$emit("mediaError",e)}}})]):[s("img",{ref:"gifElement",staticClass:"post_gif_media m-img-not-fluid",attrs:{src:t.isPlaying?t.mediaFull:t.videoCommonMixin_preview,alt:"",loading:"lazy"},on:{load:t.onMediaLoaded,error:function(e){return t.$emit("mediaError",e)}}}),s("div",{staticClass:"b-post__media__overlay"})],s("div",{staticClass:"video-js m-btn-gif",class:{"vjs-fullscreen":t.isFullscreen}},[s("button",{staticClass:"vjs-fullscreen-control vjs-control vjs-button",attrs:{title:t.fullscreenTitle},on:{click:t.toggleFullscreen,touchstart:function(e){e.stopPropagation()},touchmove:function(e){e.stopPropagation()},touchend:function(e){e.stopPropagation()}}},[s("span",{staticClass:"vjs-icon-placeholder"})])])],2)])},o=[],n=t(826489),r=t(211068),a=t(354068),l=t(447836),d=t(350219),u=t(176041),h,c={name:"PostGif",directives:{doubleClick:l.Ay},mixins:[r.A,a.A],data(){return{isFullscreen:!1,isPlaying:!1,playPromise:null}},computed:{isVideo(){return(0,u.cZ)(this.media)},mediaFull(){var e;const{files:i}=this.media;return(null==i||null===(e=i.full)||void 0===e?void 0:e.url)||""},fullscreenTitle(){return this.isFullscreen?this.$t("message.non_fullscreen_title"):this.$t("message.fullscreen_title")}},watch:{mediaFull(){this.$nextTick((()=>{this.reloadVideoAfterChangeSource()}))},documentFullscreenMixin_isFullscreen(e){if(!n.isMacOs)return;const{videoElement:i}=this.$refs;if(!i&&e)return;const t=(0,d.A)(i,{width:i.offsetWidth-1+"px"});window.requestAnimationFrame((()=>{t()}))}},methods:{onPauseVideo(e){const{target:i}=e;if(n.isIOS&&"VIDEO"===(null==i?void 0:i.tagName)){const e=i.webkitDisplayingFullscreen;!e&&this.isPlaying&&this.togglePlayingCallback(!0),e&&(this.isPlaying=!1)}},onPlayVideo(e){const{target:i}=e;n.isIOS&&"VIDEO"===(null==i?void 0:i.tagName)&&(this.isPlaying=!0)},reloadVideoAfterChangeSource(){const{videoElement:e}=this.$refs;this.isVideo&&e&&(e.load(),this.togglePlayingCallback(!0))},onDoubleClick(e,i){i===l.Nl.CLICK&&(this.$emit("singleClick",e),this.togglePlaying(e)),i===l.Nl.DOUBLE_CLICK&&this.$emit("doubleClick",e)},onFullscreenChange(){var e;const i=document.fullscreenElement||(null===(e=this.$refs.videoElement)||void 0===e?void 0:e.webkitDisplayingFullscreen)||document.webkitDisplayingFullscreen||document.webkitIsFullScreen||document.webkitCurrentFullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;this.isFullscreen=!!i,document.documentElement.classList.toggle("m-video-fullscreen",this.isFullscreen)},toggleFullscreen(e){e.preventDefault(),this.isFullscreen?this.exitFullscreen():this.requestFullscreen()},requestFullscreen(){const e=this.$refs.gifWrapper,i=this.$refs.videoElement;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():i&&i.webkitEnterFullScreen&&i.webkitEnterFullScreen()},exitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},togglePlayingCallback(e){this.isPlaying=void 0!==e?e:!this.isPlaying,this.$nextTick((()=>{if(this.isPlaying)if(this.isVideo){if(this.$refs.videoElement)try{this.playPromise=this.$refs.videoElement.play().catch((()=>{})),void 0!==this.playPromise&&this.playPromise.catch((()=>{}))}catch(e){}}else this.$refs.gifElement.src=this.mediaFull;else this.isVideo&&this.playPromise&&this.playPromise.then((()=>{if(this.$refs.videoElement)try{this.$refs.videoElement.pause()}catch(e){}this.playPromise=null})).catch((()=>{}))}))},togglePlaying(e){e&&e.target.classList.contains("vjs-fullscreen-control")||(this.$parent.toggleLike?(e&&(e.stopPropagation(),e.preventDefault()),this.$parent.toggleLike(e,(()=>{this.togglePlayingCallback()}))):this.togglePlayingCallback())},visibilityChanged(e){this.togglePlayingCallback(e)},onMediaLoaded(){this.$emit("load")}}},m,p,v=(0,t(281656).A)(c,s,o,!1,null,"74c4ed87",null).exports},421585:function(e,i,t){var s=t(596131),o=t(761489),n=Math.max;function r(e,i,t){var r=null==e?0:e.length;if(!r)return-1;var a=null==t?0:o(t);return a<0&&(a=n(r+a,0)),s(e,i,a)}e.exports=r},429822:function(e,i,t){"use strict";t.d(i,{A:function(){return d}});var s=function e(){var i,t=this._self._c;return t("div",{staticClass:"post_media__loading"},[t("svg",{staticClass:"g-icon m-static-icon",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"}},[t("path",{attrs:{d:"M12 .9a2.12 2.12 0 1 0 1.48.62A2.09 2.09 0 0 0 12 .9zM5.64 3.69A1.95 1.95 0 1 0 7 4.26a1.95 1.95 0 0 0-1.36-.57zM4.79 12a1.75 1.75 0 0 0-.53-1.26 1.76 1.76 0 0 0-2.52 0 1.76 1.76 0 0 0 0 2.52 1.76 1.76 0 0 0 2.52 0A1.75 1.75 0 0 0 4.79 12zm.85 4.74a1.67 1.67 0 0 0-1.16.47A1.64 1.64 0 0 0 4 18.36 1.61 1.61 0 0 0 5.64 20a1.64 1.64 0 0 0 1.15-.47 1.67 1.67 0 0 0 .47-1.16 1.6 1.6 0 0 0-1.62-1.62zM12 19.53a1.47 1.47 0 1 0 1 .47 1.45 1.45 0 0 0-1-.47zm6.36-2.48a1.3 1.3 0 0 0-1.31 1.31 1.31 1.31 0 0 0 1.31 1.32 1.33 1.33 0 0 0 1.32-1.32 1.31 1.31 0 0 0-1.32-1.31zm3.46-5.87a1.16 1.16 0 1 0 .34.82 1.16 1.16 0 0 0-.34-.82zm-3.46-4.54a1 1 0 0 0 .71-.3 1 1 0 0 0-1.41-1.41 1 1 0 0 0 .7 1.71z"}})])])},o=[],n,r={name:"PostMediaLoader"},a,l,d=(0,t(281656).A)(r,s,o,!1,null,"31e501aa",null).exports},494394:function(e,i,t){var s=t(143360),o=t(242e3),n,r=Object.prototype.hasOwnProperty,a=o((function(e,i,t){r.call(e,t)?e[t].push(i):s(e,t,[i])}));e.exports=a},539754:function(e,i,t){var s=t(983729),o=t(480909),n=t(724066),r=t(956449);function a(e,i){var t;return(r(e)?s:o)(e,n(i))}e.exports=a},587612:function(e,i,t){var s=t(679770),o=t(616574),n=t(315389),r=t(956449);function a(e,i){var t;return(r(e)?s:o)(e,n(i,3))}e.exports=a},616574:function(e,i,t){var s=t(480909);function o(e,i){var t=[];return s(e,(function(e,s,o){i(e,s,o)&&t.push(e)})),t}e.exports=o},658407:function(e,i,t){"use strict";t.d(i,{A:function(){return Q}});var s=function e(){var i=this,t=i._self._c;return t("post-media-wrapper",{key:i.customKeyForMediaWrapper,ref:"posMediaWrapperRef",staticClass:"b-post-media-holder js-post-media-holder",class:{"m-video m-with-btn-play":i.visibleVideos.length||i.visibleGifs.length,"m-one-video":i.oneVideo||i.oneGif,"m-only-video":i.onlyVideo||i.onlyGifs||i.onlyVideoGifs,"m-diff-ratio":i.hasDiffRatios,"m-has-addressbar":i.isMobileTabletDevice,"m-edge-detection":i.isEdge,"m-co-stream":i.post.hasCoStream},attrs:{"at-attr":"post_media"}},[i.isBlurPhoto?t("div",{staticClass:"b-chat__message__pay-btn blur-photo-btn",on:{click:function(e){i.isBlurPhoto=!1}}},[t("span",{staticClass:"g-btn m-dark-bg m-rounded m-no-uppercase m-default-font-weight"},[t("span",[i._v(i._s(i.$t("message.click_to_open")))])])]):i._e(),t("switcher",{directives:[{name:"show",rawName:"v-show",value:!i.isPlaying&&i.visibleMediaWithoutAudio.length>1&&!i.isMemoryPost,expression:"!isPlaying && visibleMediaWithoutAudio.length > 1 && !isMemoryPost"}],class:{"m-pause-video":i.wasPlayed[i.currentMediaId]&&i.isVideoSlide&&!i.isPlaying},attrs:{post:i.post,message:i.message,"current-media-type-item-num":i.currentMediaTypeItemNum,"current-index":i.currentContentIndex,"is-linked":i.isLinked},on:{changeType:i.setMediaType}}),i.visibleMediaWithoutAudio.length>1?t("swiper",{key:i.swiperKey,ref:"postSwiper",staticClass:"b-slideshow",class:{"m-square":"squarePreview"===i.mediaPreviewType,"m-only-video":i.onlyVideo||i.onlyGifs||i.onlyVideoGifs},style:i.mediaSizeStyle,attrs:{options:i.mediaOptions},on:{ready:i.onSwiperReady,slideChange:i.slideChange,sliderMove:i.sliderMove,touchEnd:i.touchEnd}},[i._l(i.visibleMediaWithoutAudio,(function(e,s){return t("swiper-slide",{key:e.id},[i.isSlideVisible(s)?t("post-media-item",{class:{"m-no-pointer":i.sliderIsMoving},style:{filter:i.isBlurPhoto?"blur(20px)":""},attrs:{"media-item":e,"preview-type":i.mediaPreviewType,"is-disabled-favorites":i.isDisabledFavorites,"is-memory-post":i.isMemoryPost,post:i.post,message:i.message,"entity-type":i.entityType,template:i.template,"is-slide-item":""},on:{changeVideoState:i.changeVideoState,doubleClick:i.onDoubleClick,singleClick:i.gallerySlideClicked,"~mediaError":function(e){return i.mediaError.apply(null,arguments)},onMediaLoaded:i.onMediaLoaded}}):i._e()],1)})),t("div",{staticClass:"swiper-button-prev",class:{"g-hidden":i.isPlaying},attrs:{slot:"button-prev"},slot:"button-prev"},[t("span",{staticClass:"b-swiper-button-icon"},[t("svg",{directives:[{name:"svg-sprite",rawName:"v-svg-sprite:icon-arrow-left",arg:"icon-arrow-left"}]})])]),t("div",{staticClass:"swiper-button-next",class:{"g-hidden":i.isPlaying},attrs:{slot:"button-next"},slot:"button-next"},[t("span",{staticClass:"b-swiper-button-icon"},[t("svg",{directives:[{name:"svg-sprite",rawName:"v-svg-sprite:icon-arrow-right",arg:"icon-arrow-right"}]})])])],2):1===i.visiblePhotos.length?t("div",{staticClass:"post_img_block g-pointer-cursor"},[t("post-media-item",{style:{filter:i.isBlurPhoto?"blur(20px)":""},attrs:{"media-item":i.visiblePhotos[0],"preview-type":i.mediaPreviewType,"is-disabled-favorites":i.isDisabledFavorites,"is-memory-post":i.isMemoryPost,post:i.post,message:i.message,"entity-type":i.entityType},on:{"~mediaError":function(e){return i.mediaError.apply(null,arguments)},doubleClick:i.onDoubleClick,singleClick:function(e){return i.showPhotoSwipeIndex(0)},onMediaLoaded:i.onMediaLoaded}})],1):i.visibleMediaWithoutAudio.length?t("post-media-item",{style:{filter:i.isBlurPhoto?"blur(20px)":""},attrs:{"media-item":i.visibleMediaWithoutAudio[0],"preview-type":i.mediaPreviewType,"is-memory-post":i.isMemoryPost,"is-disabled-favorites":i.isDisabledFavorites,post:i.post,message:i.message,"entity-type":i.entityType,"is-linked":i.isLinked},on:{changeVideoState:i.changeVideoState,"~mediaError":function(e){return i.mediaError.apply(null,arguments)},doubleClick:i.onDoubleClick,singleClick:function(e){return i.showPhotoSwipeIndex(0)},onMediaLoaded:i.onMediaLoaded}}):i._e(),i.showMediaLoader?t("post-media-loader"):i._e()],1)},o=[],n=t(738221),r=t.n(n),a=t(97200),l=t.n(a),d=t(763375),u=t.n(d),h=t(858156),c=t.n(h),m=t(218111),p=t(161701),v=t(13579),g=t(962953),y=t(826489),f=t(110908),w=function e(){var i=this,t=i._self._c;return t("div",{directives:[{name:"double-click",rawName:"v-double-click",value:i.onBlurDoubleClick,expression:"onBlurDoubleClick"}],staticClass:"b-post__media__item-inner",class:[`m-${i.mediaItem.type}`,{"m-black-bg":"photo"===i.mediaItem.type&&!i.isChat&&!i.isStatistics||"video"===i.mediaItem.type}],attrs:{"at-attr":"media_locator"}},[t("transition",{attrs:{name:"bounce"}},[i.isShowFavorite?t("div",{staticClass:"media-like"},[t("svg",{directives:[{name:"svg-sprite",rawName:"v-svg-sprite:icon-liked",arg:"icon-liked"}]})]):i._e()]),i.isShowIconLock?t("span",{staticClass:"b-post-content-free-icon m-media-free"},[t("svg",{directives:[{name:"svg-sprite",rawName:"v-svg-sprite:icon-price-free",arg:"icon-price-free"}]})]):i._e(),i.mediaItem.hasError?t("unknown-post",{attrs:{"icon-near-text":"",message:i.$t("message.media_has_error_for_post")}}):["photo"===i.mediaItem.type?[i.shouldHaveBlurredBg?t("div",{staticClass:"b-post__media-bg",style:{backgroundImage:`url(${i.mediaItem.thumb||i.imageSrc})`}}):i._e(),t("image-o-f",i._b({class:{"img-responsive":1===i.visibleMediaWithoutAudio.length,"m-object-contain":i.shouldHaveBlurredBg},attrs:{src:i.imageSrc,draggable:"false"},on:{"~load":function(e){return i.onMediaLoaded.apply(null,arguments)},"~error":function(e){return i.mediaError.apply(null,arguments)}}},"image-o-f",i.imageSize||{},!1))]:i._e(),"gif"===i.mediaItem.type?[i.isMemoryPost?t("post-memories-gif",{attrs:{media:i.mediaItem},on:{load:i.onMediaLoaded}}):t("post-gif",{attrs:{media:i.mediaItem,"is-linked":i.isLinked},on:{doubleClick:i.onDoubleClick,"~mediaError":function(e){return i.mediaError.apply(null,arguments)},load:i.onMediaLoaded}})]:i._e(),"video"===i.mediaItem.type?t("post-video",{key:i.videoKey,attrs:{id:i.entityId,type:i.entityType,media:i.mediaItem,"stream-id":i.post.streamId||0,"is-linked":i.isLinked,"is-slide-item":i.isSlideItem},on:{changeVideoState:function(e){return i.$emit("changeVideoState",e)},"~videoError":function(e){return i.mediaError.apply(null,arguments)},drmError:i.onDrmError,singleClick:i.onSingleClick,doubleClick:i.onDoubleClick,load:i.onMediaLoaded}}):i._e()]],2)},b=[],P=t(447836),C=t(375168),M=function e(){var i=this,t=i._self._c;return t("div",{staticClass:"b-post-memories-gif"},[t("img",{staticClass:"b-post-memories__blurred-bg m-blur-static",attrs:{alt:"blurred-background",loading:"lazy",src:i.mediaSrc}}),t("img",{staticClass:"b-post-memories__main-bg m-img-not-fluid",attrs:{loading:"lazy",src:i.mediaSrc,width:i.videoCommonMixin_mediaWidth,height:i.videoCommonMixin_mediaHeight,alt:"main-background"},on:{load:i.onMediaLoaded}}),t("span",{staticClass:"post_gif_play m-no-pointer g-btn-play m-lg-size"},[t("svg",{directives:[{name:"svg-sprite",rawName:"v-svg-sprite:icon-play",arg:"icon-play"}]})])])},x=[],_,k,S={name:"PostMemoriesGif",mixins:[t(354068).A],data(){return{}},computed:{mediaSrc(){var e;return this.videoCommonMixin_preview||(null===(e=this.media.files.thumb)||void 0===e?void 0:e.url)||""}},methods:{onMediaLoaded(){this.$emit("load")}}},E=t(281656),I,$=(0,E.A)(S,M,x,!1,null,"6ef7c2d8",null).exports,A=t(951498),V=t(331607),F=t(775074),T=t(178688),L=t(463670),W,D={name:"PostMediaItem",directives:{doubleClick:P.Ay},components:{ImageOF:A.A,PostGif:C.A,PostVideo:V.A,UnknownPost:F.A,PostMemoriesGif:$},mixins:[T.A],props:{post:{type:Object,required:!0},mediaItem:{type:Object,required:!0},previewType:{type:String,required:!0},isLinked:{type:Boolean,default:!1},isMemoryPost:{type:Boolean,default:!1},isDisabledFavorites:{type:Boolean,default:!1},message:{type:Object,default:()=>{}},entityType:{type:String,default:L.Tj.OWN_MEDIA},isSlideItem:{type:Boolean,default:!1}},data(){return{isMediaError:!1,isShowFavorite:!1,videoKey:+new Date}},computed:{...(0,f.npG)(["authUserId"]),imageSize(){var e;if("squarePreview"===this.previewType&&this.mediaItem[this.previewType])return{width:960,height:960};const{width:i,height:t}=(null===(e=this.mediaItem)||void 0===e||null===(e=e.files)||void 0===e?void 0:e.preview)||{};return i&&t?{width:i,height:t}:null},isDisabledToggleFavorite(){return!this.post.canToggleFavorite||this.isLinked||this.isDisabledFavorites},isShowIconLock(){return this.privatePost&&this.preview.includes(this.mediaItem.id)&&(this.isPostUser||this.isMineMessage||this.isTemplate||this.isQueue)},imageSrc(){var e;const{files:i={}}=this.mediaItem||{};return(null===(e=i[this.previewType]||i.preview||i.thumb)||void 0===e?void 0:e.url)||""}},errorCaptured(e,i,t){return Sentry.withScope((s=>{s.setExtra("error",e),s.setExtra("vm",i),s.setExtra("info",t),s.setExtra("details","PostMediaItem"),Sentry.captureException(e)})),!1},methods:{onBlurDoubleClick(e,i){"photo"===this.mediaItem.type&&(i===P.Nl.DOUBLE_CLICK&&this.onDoubleClick(e),i===P.Nl.CLICK&&this.onSingleClick(e))},onMediaLoaded(){this.$emit("onMediaLoaded")},onDoubleClick(e){this.isDisabledToggleFavorite||(this.$emit("doubleClick",e),this.showFavoriteAnimation())},onSingleClick(e){this.$emit("singleClick",e)},showFavoriteAnimation(){this.isShowFavorite=!0,setTimeout((()=>{this.isShowFavorite=!1}),600)},mediaError(e){this.isMediaError||(this.isMediaError=!0,this.$emit("mediaError",e))},onDrmError(){this.videoKey=+new Date}}},B,N=(0,E.A)(D,w,b,!1,null,"6e72485c",null).exports,O=t(996705),z=t(969200),R=t(429822),j=t(561594),G=t(765624),H=t(281496),q=t(62886),K={name:"PostMedia",components:{PostMediaItem:N,Switcher:O.A,PostMediaWrapper:z.A,PostMediaLoader:R.A},mixins:[T.A,j.A,G.A,H.A,q.A],props:{post:{type:Object,required:!0},isLinked:{type:Boolean,default:!1},message:{type:Object,default:()=>{}},isDisabledFavorites:{type:Boolean,default:!1},isPurchased:{type:Boolean,default:!1},isMassMessage:{type:Boolean,default:!1},isMemoryPost:{type:Boolean,default:!1}},data(){return{isPlaying:!1,wasPlayed:{},currentMediaTypeItemNum:1,currentContentIndex:0,player:null,mediaOptions:{autoHeight:!1,threshold:y.isMobile?0:10,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},noSwipingClass:"swiper-no-swiping"},isVideoSlide:!1,sliderIsMoving:!1,isMediaError:!1,isBlurPhoto:!1,isMediaForPostLoaded:!1,reloadingAfterFirstMediaError:!1,windowInnerWidth:0,currentMediaId:null,mediaSizeStyle:{}}},computed:{...(0,f.ZOz)(["getUser"]),customKeyForMediaWrapper(){return y.isSafari&&y.isMacOs&&this.isMediaForPostLoaded?l()("MEDIA_WRAPPER_KEY"):"DEFAULT_KEY"},onlyVideo(){return this.visibleVideos.length&&!this.visiblePhotos.length&&!this.visibleGifs.length},oneVideo(){return this.onlyVideo&&1===this.visibleVideos.length},onlyGifs(){return this.visibleGifs.length&&!this.visiblePhotos.length&&!this.visibleVideos.length},onlyVideoGifs(){return this.visibleGifs.length&&this.visibleVideos.length&&!this.visiblePhotos.length},allMedias(){return[...this.visiblePhotos,...this.visibleVideos,...this.visibleGifs]},hasDiffRatios(){const e=this.allMedias.map((e=>{var i;const{width:t,height:s}=(null===(i=e.files)||void 0===i?void 0:i.full)||{};return t>s?1:t<s?-1:0}));return u()(e).length>1},oneGif(){return this.onlyGifs&&1===this.visibleGifs.length},isMobileTabletDevice:()=>y.isMobile,isEdge(){return y.isEdge},entityType(){const{OWN_MEDIA:e,MESSAGE:i,POST:t}=L.Tj;switch(!0){case(this.isTypeMessage||this.isTemplate)&&(this.isMassMessage||this.isQueue):case this.isSettingsMessaging:return e;case this.isTypeMessage||this.isTemplate:return i;case Boolean(this.post):return t;default:return e}},swiperKey(){return`${this.visibleMediaWithoutAudio.length}-${this.windowInnerWidth}`},showMediaLoader(){return!this.isMediaForPostLoaded||this.reloadingAfterFirstMediaError}},watch:{visibleMediaWithoutAudio:{handler(e){null!=e&&e.length&&!Object.keys(this.wasPlayed).length&&(this.isVideoSlide="video"===e[0].type,this.currentMediaId=e[0].id)},immediate:!0},isPurchased(e){e&&(this.slideToPaidContent(),this.getMediaSizeStyle())}},mounted(){this.$root.$on(`post-fetched-${this.post.id}`,this.slideToPaidContent),"Chat"===this.$route.name&&this.toggleIsBlurPhoto(),window.addEventListener("resize",this.onResizeHandler),this.getMediaSizeStyle({isPresetWidth:this.isMobileTabletDevice})},beforeDestroy(){this.$root.$off(`post-fetched-${this.post.id}`,this.slideToPaidContent),window.removeEventListener("resize",this.onResizeHandler)},methods:{...(0,f.$GZ)(["fetchPost"]),...(0,f.SUe)(["fetchHash"]),onDoubleClick(e){this.$emit("doubleClick",e)},gallerySlideClicked(){const e=c()(this,"swiper.realIndex")||0,i=c()(this,`visibleMediaWithoutAudio[${e}].type`);["video","gif"].includes(i)||this.showPhotoSwipeIndex(e)},showPhotoSwipeIndex(e){this.isBlurPhoto||this.showPhotoSwipe({index:e})},findIndex(e){return this.visibleMediaWithoutAudio.findIndex((({id:i})=>i===e[0].id))},setMediaType(e){const{media:i}=this.visibleMediaWithoutAudioByType[e];this.currentContentIndex!==e&&(this.swiper&&this.swiper.slideTo(this.findIndex(i)),this.currentContentIndex=e)},changeVideoState({isPlaying:e,mediaId:i}){this.isPlaying=e,e&&(this.wasPlayed={...this.wasPlayed,[i]:!0})},slideChange(){this.$root.$emit("changePostMediaType",this.post.id),this.$nextTick((()=>{const e=c()(this,"$refs.postSwiper.$swiper");e&&(this.swiper=e);const i=c()(e,"realIndex"),t=c()(this,`visibleMediaWithoutAudio[${i}].type`);this.isVideoSlide="video"===t;const s=c()(this,`visibleMediaWithoutAudio[${i}].id`);this.currentMediaId=s;const o=this.visibleMediaWithoutAudioByType.findIndex((({media:e})=>e.some((e=>e.id===s)))),n=c()(this,`visibleMediaWithoutAudioByType[${o}].media`);null!=n&&n.length&&(this.currentMediaTypeItemNum=n.findIndex((e=>e.id===s))+1,o!==this.currentContentIndex&&(this.currentContentIndex=o))}))},slideToPaidContent(){this.$nextTick((()=>{this.paidVisibleMediaWithoutAudio.length&&this.$nextTick((()=>{const e=c()(this,"paidVisibleMediaWithoutAudio[0].id"),i=this.allMediaWithoutAudioByType.findIndex((({media:i})=>i.some((({id:i})=>i===e)))),t=c()(this,`allMediaWithoutAudioByType[${i}].media`),s=undefined,o=this.allMediaWithoutAudio.findIndex((i=>i.id===e)),n=this.allMediaWithoutAudioByType.findIndex((({media:i})=>i.some((({id:i})=>i===e)))),r=c()(this,"$refs.postSwiper.$swiper");r&&(this.swiper=r,r.slideTo(o,400));const a=c()(this,`allMediaWithoutAudio[${o}].type`);this.isVideoSlide="video"===a,this.currentMediaTypeItemNum=t.findIndex((i=>i.id===e))+1,n!==this.currentContentIndex&&(this.currentContentIndex=n)}))}))},sliderMove(){this.sliderIsMoving=!0},touchEnd(){this.sliderIsMoving=!1},async mediaError(e){if(this.isMediaError)return;this.isMediaError=!0,await this.fetchHash();const i=null==e?void 0:e.playerError;this.isChat?this.$emit("mediaError",e):(i&&(this.reloadingAfterFirstMediaError=!0),await this.fetchPost({id:this.post.id}),i&&(this.reloadingAfterFirstMediaError=!1),this.updatePhotoSwipeDataSource())},toggleIsBlurPhoto(){const{chatId:e}=this.$route.params,i=this.getUser(e);this.message.canPurchase||this.message.isFree||!this.message.isOpened?this.isMineMessage||!1!==i.isRealPerformer&&i.isPerformer||(this.isBlurPhoto=!0):this.isBlurPhoto=!1},onMediaLoaded(){this.$emit("onMediaLoaded"),this.isMediaForPostLoaded=!0},onResizeHandler:r()((function(){const e=undefined;document.documentElement.classList.contains("m-video-fullscreen")||this.isPlaying||(this.windowInnerWidth=window.innerWidth)}),200),isSlideVisible(e){const i=c()(this,"$refs.postSwiper.$swiper");return!i||Math.abs(e-i.activeIndex)<=1},getMediaSizeStyle({isPresetWidth:e=!1}={}){if(!this.isChat){const i=this.$refs.posMediaWrapperRef;if(i){const{width:t,height:s}=i.$el.getBoundingClientRect(),o={height:`${s}px`};e&&(o.width=`${t}px`),this.mediaSizeStyle=o}}},onSwiperReady(){this.$nextTick(this.getMediaSizeStyle)}}},U=K,Z,Q=(0,E.A)(U,s,o,!1,null,"3efb86ee",null).exports},662429:function(e,i,t){var s=t(480909);function o(e,i,t,o){return s(e,(function(e,s,n){i(o,e,t(e),n)})),o}e.exports=o},663945:function(e){function i(e,i,t,s){for(var o=-1,n=null==e?0:e.length;++o<n;){var r=e[o];i(s,r,t(r),e)}return s}e.exports=i},724066:function(e,i,t){var s=t(383488);function o(e){return"function"==typeof e?e:s}e.exports=o},964532:function(e,i,t){"use strict";t.d(i,{A:function(){return h}});var s=function e(){var i=this,t=i._self._c;return t("div",{directives:[{name:"waypoint",rawName:"v-waypoint",value:{active:!0,callback:i.onWaypoint,options:i.intersectionOptions},expression:"{ active: true, callback: onWaypoint, options: intersectionOptions }"}],staticClass:"audio-wrapper js-audio-wrapper"},[t("custom-audio-player",{ref:"audio",attrs:{src:i.src,"hide-error":!i.audio.isReady},on:{play:i.onAudioPlay}})],1)},o=[],n=t(826489),r,a,l={name:"AudioPlayer",components:{CustomAudioPlayer:t(289584).A},props:{audio:{type:Object,required:!0},responseType:{type:String,required:!0}},data(){return{intersectionOptions:{threshold:[.5,.75]}}},computed:{src(){var e;return(null===(e=this.audio.files)||void 0===e||null===(e=e.full)||void 0===e?void 0:e.url)||""}},mounted(){document.addEventListener("visibilitychange",this.visibilityChangeHandler)},beforeDestroy(){document.removeEventListener("visibilitychange",this.visibilityChangeHandler)},methods:{onWaypoint({going:e}){e===this.$waypointMap.GOING_OUT&&this.$refs.audio&&this.pauseAudio()},pauseAudio(){var e;null===(e=this.$refs.audio)||void 0===e||e.pauseAudio()},onAudioPlay(){this.$root.$emit("pausePlayerVideo")},visibilityChangeHandler(){document.hidden&&n.isMobile&&this.pauseAudio()}}},d,u,h=(0,t(281656).A)(l,s,o,!1,null,null,null).exports},976135:function(e,i,t){e.exports=t(539754)}}]);